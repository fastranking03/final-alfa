<html lang="en">

</html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edit Product | Alfamenswear</title>
    <%- include('includes/head') %>
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body>
    <div>
        <div class="flex">
            <%- include('includes/side-bar') %>

                <div class="pages">
                    <div>
                        <%- include('includes/header') %>
                    </div>
                    <!-- Page Content -->
                    <div class="p-5">
                        <div>
                            <div class="">
                                <h3 class="text-2xl font-bold">Edit Product</h3>
                            </div>
                            <div class="mt-4">
                                <form method="post" action="/admin/edit-product" enctype="multipart/form-data">
                                    <div class="flex gap-5">
                                        <div class="sm:w-[50%]">
                                            <div>
                                                <label class="font-[600]">Wear Type</label>
                                                <select name="wear_type_id" class="p-2 border-[1px] rounded-[10px] w-[100%] mt-2 outline-none">
                                                    <option value="active">Select</option>
                                                 <% typeData.forEach(data =>{ %> 
                                                       <option value="<%= data.id %>" <% if (data.id === editProduct.wear_type_id) { %> 
                                                        selected 
                                                    <% } %>> <%= data.i_type %> </option>
                                                    <%})%>   
                                                 </select>
                                            </div>
                                        </div>
                                        <div class="sm:w-[50%]">
                                            <div>
                                                <label class="font[600]">Category Name</label>
                                                <select name="cat_id"
                                                    class="p-2 border-[1px] rounded-[10px] w-[100%] mt-2 outline-none"
                                                    required>
                                                    <option value="">Select</option>
                                                    <% catData.forEach((data)=>{ %>
                                                        <option value="<%= data.id %>" <% if (data.id === editProduct.cat_id) { %> 
                                                            selected 
                                                        <% } %> data-menu_id="<%= data.id %>">
                                                            <%= data.cat_name %>
                                                        </option>
                                                        <% }) %>
                                                </select>
                                            </div>
                                        </div>
                                     </div>
                                     <div class="flex gap-5 mt-5">
                                        <div class="sm:w-[50%]">
                                            <div>
                                                <label class="font-[600]">Product Name</label>
                                                <input type="text" name="p_name" value="<%= editProduct.p_name %>"
                                                    class="p-2 border-[1px] rounded-[10px] w-[100%] mt-2 outline-none"
                                                    required>
                                            </div>
                                        </div>
                                        <div class="sm:w-[50%]">
                                            <div>
                                                <label class="font-[600]">Seo Url</label>
                                                <input type="text" name="p_url" id="seo-url" value="<%= editProduct.p_url %>"
                                                    class="p-2 border-[1px] rounded-[10px] w-[100%] mt-2 outline-none"
                                                    required>
                                            </div>
                                        </div>
                                        <div class="sm:w-[50%]">
                                            <div>
                                                <label class="font[600]">Similar Product</label>
                                                <select name="similar_product" id=""
                                                    class="p-2 border-[1px] rounded-[10px] w-[100%] mt-2 outline-none">
                                                    <option value="">Select</option>
                                                    <option value="yes" <% if (editProduct.similar_product==="yes" ) { %>
                                                        selected <% } %>>Yes</option>
                                                    <option value="no" <% if (editProduct.similar_product==="no" ) { %>
                                                        selected <% } %>>No</option>
                                                </select>
                                            </div>
                                        </div>
                                        <script>
                                            document.getElementById('product-name').addEventListener('input', function() {
                                                const productName = this.value;
                                                const seoUrl = productName
                                                    .toLowerCase()
                                                    .replace(/[^a-z0-9\s]/g, '')
                                                    .trim()
                                                    .replace(/\s+/g, '-');
                                                document.getElementById('seo-url').value = seoUrl;
                                            });

                                        </script>
                                     </div>
                                    <div class="flex gap-5 mt-5">
                                        <div class="sm:w-[50%]">
                                            <div>
                                                <label class="font-[600]">Product Price</label>
                                                <input type="text" name="p_price" id="price"
                                                    value="<%= editProduct.p_price %>"
                                                    class="p-2 border-[1px] rounded-[10px] w-[100%] mt-2 outline-none"
                                                    required>
                                            </div>
                                        </div>
                                        <div class="sm:w-[50%]">
                                            <div>
                                                <label class="font-[600]">Discount</label>
                                                <input type="text" name="discount" id="discount"
                                                    value="<%= editProduct.discount %>"
                                                    class="p-2 border-[1px] rounded-[10px] w-[100%] mt-2 outline-none"
                                                    required>
                                            </div>
                                        </div>
                                        <div class="sm:w-[50%]">
                                            <div>
                                                <label class="font-[600]">Main Price</label>
                                                <input type="text" name="p_main_price"
                                                    value="<%= editProduct.p_main_price %>" id="mainPrice"
                                                    class="p-2 border-[1px] rounded-[10px] w-[100%] mt-2 outline-none"
                                                    required>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="flex gap-5 mt-5">
                                        <div class="sm:w-[50%]">
                                            <div>
                                                <label class="font-[600]">Product Title</label>
                                                <input type="text" name="p_title" value="<%= editProduct.p_title %>"
                                                    class="p-2 border-[1px] rounded-[10px] w-[100%] mt-2 outline-none"
                                                    required>
                                            </div>
                                        </div>
                                        <div class="sm:w-[50%]">
                                            <div>
                                                <label class="font[600]">New Arrival</label>
                                                <select name="new_arrival" id=""
                                                    class="p-2 border-[1px] rounded-[10px] w-[100%] mt-2 outline-none">
                                                    <option value="">Select</option>
                                                    <option value="yes" <% if (editProduct.new_arrival==="yes" ) { %>
                                                        selected <% } %>>Yes</option>
                                                    <option value="no" <% if (editProduct.new_arrival==="no" ) { %>
                                                        selected <% } %>>No</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="sm:w-[50%]">
                                            <div>
                                                <label class="font[600]">Best Seller</label>
                                                <select name="best_seller" id=""
                                                    class="p-2 border-[1px] rounded-[10px] w-[100%] mt-2 outline-none">
                                                    <option value="">Select</option>
                                                    <option value="yes" <% if (editProduct.best_seller==="yes" ) { %>
                                                        selected <% } %>>Yes</option>
                                                    <option value="no" <% if (editProduct.best_seller==="no" ) { %>
                                                        selected <% } %>>No</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="sm:w-[50%]">
                                            <div>
                                                <label class="font-[600]">Tags</label>
                                                <input type="text" name="tags" value="<%= editProduct.tags %>"
                                                    class="p-2 border-[1px] rounded-[10px] w-[100%] mt-2 outline-none">
                                            </div>
                                        </div>
                                    </div>

                                    <div class="flex gap-5 mt-5">
                                        <div class="sm:w-[50%]">
                                            <div>
                                                <label class="font-[600]">Brand</label>
                                                <input type="text" name="brand" value="<%= editProduct.brand %>"
                                                    class="p-2 border-[1px] rounded-[10px] w-[100%] mt-2 outline-none">
                                            </div>
                                        </div>
                                        <div class="sm:w-[50%]">
                                            <div>
                                                <label class="font-[600]">SKU</label>
                                                <input type="text" name="sku" value="<%= editProduct.sku %>"
                                                    class="p-2 border-[1px] rounded-[10px] w-[100%] mt-2 outline-none">
                                            </div>
                                        </div>
                                        <div class="sm:w-[50%]">
                                            <div>
                                                <label class="font-[600]">Barcode</label>
                                                <input type="text" id="barcode" name="barcode" value="<%= editProduct.barcode %>"
                                                    class="p-2 border-[1px] rounded-[10px] w-[100%] mt-2 outline-none" >
                                            </div>
                                        </div>
                                        <div class="sm:w-[50%]">
                                            <div>
                                                <label class="font-[600]">Colour</label>
                                                <input type="text" name="colour" value="<%= editProduct.colour %>"
                                                    class="p-2 border-[1px] rounded-[10px] w-[100%] mt-2 outline-none">
                                            </div>
                                        </div>
                                    </div>

                                    <div class="flex gap-5 mt-5">
                                        <div class="sm:w-[100%]">
                                            <div>
                                                <label class="font-[600]">Description</label>
                                                <textarea type="text" name="p_desc" value="<%= editProduct.p_desc %>"
                                                    class="p-2 border-[1px] rounded-[10px] w-[100%] mt-2 outline-none"
                                                    cols="8" rows="8">
                                                <%= editProduct.p_desc %>
                                            </textarea>
                                            </div>
                                        </div>
                                        <div class="sm:w-[100%]">
                                            <div>
                                                <label class="font-[600]">Features</label>
                                                <textarea type="text" name="p_key_features"
                                                    class="p-2 border-[1px] rounded-[10px] w-[100%] mt-2 outline-none"
                                                    cols="4" rows="5">
                                                <%= editProduct.p_key_features %>
                                            </textarea>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="mt-5">
                                        <div class="sm:w-[100%]">
                                            <div>
                                                <label class="font-[600]">Image</label>
                                                <input type="file" name="p_image"
                                                    class="p-2 border-[1px] rounded-[10px] w-[100%] mt-2 outline-none">
                                                <img src="<%= editProduct.p_image %>" class="w-[60px] mt-2" alt="">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="mt-5">
                                        <div class="sm:w-[100%]">
                                            <div>
                                                <label class="font-[600]">Multiple Image</label>
                                                <input type="file" name="p_images" multiple
                                                    class="p-2 border-[1px] rounded-[10px] w-[100%] mt-2 outline-none">
                                                <div class="mt-5 flex gap-4">
                                                    <% proImage.forEach(image=>{ %>
                                                        <div class="relative">
                                                            <img src="<%= image.p_images %>"
                                                                class="w-[80px] object-cover object-top" alt="">
                                                            <div class="absolute top-[-13px] right-[-9px]">
                                                                <button type="button" class="image-delete"
                                                                    id="<%= image.id %>"><svg
                                                                        xmlns="http://www.w3.org/2000/svg" width="24"
                                                                        height="24" viewBox="0 0 24 24">
                                                                        <path fill="#ea0808"
                                                                            d="M12 4c-4.419 0-8 3.582-8 8s3.581 8 8 8s8-3.582 8-8s-3.581-8-8-8m3.707 10.293a.999.999 0 1 1-1.414 1.414L12 13.414l-2.293 2.293a.997.997 0 0 1-1.414 0a1 1 0 0 1 0-1.414L10.586 12L8.293 9.707a.999.999 0 1 1 1.414-1.414L12 10.586l2.293-2.293a.999.999 0 1 1 1.414 1.414L13.414 12z" />
                                                                    </svg></button>
                                                            </div>
                                                        </div>
                                                        <% }) %>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="mt-5 flex flex-col gap-5" id="inputContainer">
                                        <% if (proSize.length> 0) { %>
                                            <% proSize.forEach(size=> { %>
                                                <div class="flex gap-5 input-row items-center"
                                                    data-size-id="<%= size.id %>">
                                                    <div class="sm:w-[45%]">
                                                        <!-- <div>
                                                            <label class="font-[600]">Size</label>
                                                            <input type="text" name="size[]" value="<%= size.size %>"
                                                                class="p-2 border-[1px] rounded-[10px] w-[100%] mt-2 outline-none"
                                                                required>
                                                        </div> -->
                                                        <label class="font-[600]">Size</label>
                                                        <select name="size[]" id="selectMenuFecture"
                                                        class="p-2 border-[1px] rounded-[10px] w-[100%] mt-2 outline-none"
                                                        >
                                                        <option value="">Select</option>
                                                        <% sizeData.forEach((data) => { %>
                                                            <option value="<%= data.size_name %>" data-menu_id="<%= data.id %>"
                                                                <% if (size.size && size.size === data.size_name) { %> selected <% } %>>
                                                                <%= data.size_name %>
                                                            </option>
                                                        <% }) %>
                                                    </select>
                                                    
                                                        
                                                    </div>
                                                    <div class="sm:w-[45%]">
                                                        <div>
                                                            <label class="font-[600]">Quantity</label>
                                                            <input type="text" name="quantity[]"
                                                                value="<%= size.quantity %>"
                                                                class="p-2 border-[1px] rounded-[10px] w-[100%] mt-2 outline-none"
                                                                >
                                                        </div>
                                                    </div>
                                                    <div class="sm:w-[5%] flex gap-2 mt-8">
                                                        <button type="button" id="<%= size.id %>"
                                                            class="delete-size h-[42px] flex justify-center border-[1px] items-center text-white rounded-[10px] w-[50px] hover:bg-red-300">
                                                            <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" viewBox="0 0 24 24"><path fill="#e31010" d="M7 21q-.825 0-1.412-.587T5 19V6H4V4h5V3h6v1h5v2h-1v13q0 .825-.587 1.413T17 21zm2-4h2V8H9zm4 0h2V8h-2z"/></svg>
                                                        </button>
                                                    </div>
                                                </div>
                                                <% }) %>
                                                    <% } %>
                                                        <div class="flex gap-5 input-row">
                                                            <div class="sm:w-[45%]">
                                                                <div>
                                                                    <label class="font-[600]">Size</label>
                                                                    <select name="size[]" id="selectMenuFecture"
                                                                        class="p-2 border-[1px] rounded-[10px] w-[100%] mt-2 outline-none"
                                                                        >
                                                                        <option value="">Select</option>
                                                                        <% sizeData.forEach((data)=>{ %>
                                                                            <option value="<%= data.size_name %>" data-menu_id="<%= data.id %>">
                                                                                <%= data.size_name %>
                                                                            </option>
                                                                            <% }) %>
                                                                    </select>
                                                                </div>
                                                            </div>
                                                            <div class="sm:w-[45%]">
                                                                <div>
                                                                    <label class="font-[600]">Quantity</label>
                                                                    <input type="text" name="quantity[]"
                                                                        class="p-2 border-[1px] rounded-[10px] w-[100%] mt-2 outline-none"
                                                                        >
                                                                </div>
                                                            </div>
                                                            <div class="sm:w-[5%]">
                                                                <div class="mt-8">
                                                                    <button type="button"
                                                                        class="bg-green-500 p-2 px-5 text-white rounded-[10px] w-[80px] add-row">+Add</button>
                                                                </div>
                                                            </div>
                                                        </div>
                                    </div>
                                    <div class="mt-5">
                                        <input type="hidden" name="id" value="<%= editProduct.id %>"> 
                                        <button type="submit"
                                            class="p-2 bg-sky-400 text-white px-10 rounded-[10px]">Submit</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
        </div>
    </div>
    <%- include('includes/foot') %>
    <script>
        // document.addEventListener('DOMContentLoaded', () => {
        //     const wearTypeSelect = document.querySelector('select[name="wear_type_id"]');
        //     const categorySelect = document.querySelector('select[name="cat_id"]');
        //     const categoryOptions = Array.from(categorySelect.options);  
        //       wearTypeSelect.addEventListener('change', () => {
        //         const selectedWearTypeId = wearTypeSelect.value;
                
        //         categorySelect.innerHTML = '<option value="">Select</option>';
    
        //         // Filter and add matching category options
        //         categoryOptions.forEach(option => {
        //             if (option.dataset.wear_type_id === selectedWearTypeId) {
        //                 categorySelect.appendChild(option);
        //             }
                    
        //         });
        //     });
        // });
    </script>
    
        <script>
            $(document).ready(function () {
                // Attach click event to all delete buttons
                $(".image-delete").on("click", function () {
                    const imageId = $(this).attr("id"); 
                    console.log(imageId)
                    if (confirm("Are you sure you want to delete this image?")) {
                        // Make an AJAX request to delete the image
                        $.ajax({
                            url: `/admin/delete-image/${imageId}`,
                            type: "DELETE",
                            success: function (response) {
                                alert("Image deleted successfully!");
                                // Remove the parent `.relative` container from the DOM
                                $(`#${imageId}`).closest(".relative").remove();
                            },
                            error: function (xhr, status, error) {
                                alert("Failed to delete image.");
                                console.error("Error:", error);
                            },
                        });
                    }
                });
            });
            $(document).ready(function () {
                // Attach click event to all delete buttons
                $(".delete-size").on("click", function () {
                    const sizeId = $(this).attr("id"); 
                    console.log(sizeId)
                    if (confirm("Are you sure you want to delete this Size?")) {
                        // Make an AJAX request to delete the image
                        $.ajax({
                            url: `/admin/delete-size/${sizeId}`,
                            type: "DELETE",
                            success: function (response) {
                                alert("Size deleted successfully!");
                                // Remove the parent `.relative` container from the DOM
                                $(`#${sizeId}`).closest(".input-row").remove();
                            },
                            error: function (xhr, status, error) {
                                alert("Failed to delete image.");
                                console.error("Error:", error);
                            },
                        });
                    }
                });
            });

        </script>
        <script>
            var price = document.getElementById("price")
            var discount = document.getElementById("discount")
            var mainPrice = document.getElementById("mainPrice")
            price.addEventListener('input', updatePrice)
            discount.addEventListener('input', updatePrice)

            function updatePrice() {
                var priceVal = parseFloat(price.value) || 0
                var discountVal = parseFloat(discount.value) || 0
                var discountPrice = (priceVal * discountVal) / 100;
                var finalPrice = priceVal - discountPrice
                mainPrice.value = parseFloat(finalPrice)
            }

        </script>
        <script>
            $(document).on("change", "#selectMenuFecture", function () {
                // var menufecture = $(this).val()
                var menu_id = $(this).find(':selected').data('menu_id');
                $('select[name="c_modal"] option').each(function () {
                    if ($(this).val() != "") {
                        $(this).hide();
                    }
                });
                $('select[name="c_modal"] option[data-menufecture="' + menu_id + '"]').show();
            })
        </script>
        <script>
            document.addEventListener('DOMContentLoaded', function () {
                const inputContainer = document.getElementById('inputContainer');
                inputContainer.addEventListener('click', function (e) {
                    if (e.target.classList.contains('add-row')) {
                        e.preventDefault();
                        // Create a new input row
                        const newRow = document.createElement('div');
                        newRow.classList.add('flex', 'gap-5', 'input-row');
                        newRow.innerHTML = `
                        <div class="sm:w-[45%]">
                            <div>
                                <label class="font-[600]">Size</label>
                                                <select name="size[]" id="selectMenuFecture"
                                                    class="p-2 border-[1px] rounded-[10px] w-[100%] mt-2 outline-none"
                                                    >
                                                     <% sizeData.forEach((data)=>{ %>
                                                        <option value="<%= data.size_name %>" data-menu_id="<%= data.id %>">
                                                            <%= data.size_name %>
                                                        </option>
                                                        <% }) %>
                                                </select>
                            </div>
                        </div>
                        <div class="sm:w-[45%]">
                            <div>
                                <label class="font-[600]">Quantity</label>
                                <input type="text" name="quantity[]" class="p-2 border-[1px] rounded-[10px] w-[100%] mt-2 outline-none" >
                            </div>
                        </div>
                        <div class="sm:w-[8%]">
                            <div class="mt-8">
                                <button type="button" class="bg-red-500 p-2 px-2 text-white rounded-[10px] w-[80px] remove-row">Remove</button>
                            </div>
                        </div>
                    `;
                        // Append the new row to the container
                        inputContainer.appendChild(newRow);
                    }

                    if (e.target.classList.contains('remove-row')) {
                        e.preventDefault();
                        const row = e.target.closest('.input-row');
                        inputContainer.removeChild(row);
                    }
                });
            });
        </script>

</body>

</html>